(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{M:()=>J});var t={formSelector:".popup__form",fieldsetSelector:"popup__fieldset",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",errorElementSelector:".popup__span-error_active",inactiveButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_error",errorElementClass:"popup__span-error_active",buttonCloseClass:"popup__button-close",popupClass:"popup"};function n(e,t){var n=e.querySelector(t.formSelector),r=e.querySelector(t.submitButtonSelector);e.querySelector(t.inputSelector)&&!n.checkValidity()&&(r.classList.add(t.inactiveButtonClass),r.disabled=!0)}function r(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(e){console.log(e)}function a(e){var t=e.submitter;t.textContent="Сохранение...",t.disabled=!0}function i(e){var t=e.submitter;t.textContent="Сохранить",t.disabled=!1}var u={baseUrl:"https://nomoreparties.co/v1/wbc-cohort-1",headers:{authorization:"f69a8e1a-7b4c-4898-9f33-97539dca3c0c","Content-Type":"application/json"}};function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=document.querySelector(".popup__edit-profile"),f=document.querySelector(".popup__add-card"),m=document.querySelector(".popup__view-image"),y=document.querySelector(".profile__title"),v=document.querySelector(".profile__subtitle"),_=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),b=document.querySelector('input[name="fullname"]'),S=document.querySelector('input[name="profession"]'),g=document.querySelector('input[name="image-name"]'),q=document.querySelector('input[name="image-link"]'),E=document.querySelector('form[name="edit-form"]'),C=document.querySelector('form[name="add-form"]'),k=document.querySelector(".popup__update-avatar"),L=document.querySelector(".profile__avatar-image"),O=document.querySelector(".profile__update-container"),j=document.querySelector('form[name="update-avatar-form"]'),w=document.querySelector('input[name="avatar-link"]'),x=document.querySelector('form[name="delete-card-form"]'),P=document.querySelector(".popup__delete-card"),A=document.querySelectorAll(".popup");function U(e){e.classList.add("popup_opened"),document.addEventListener("keydown",T)}function D(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",T)}function T(e){"Escape"===e.code&&D(document.querySelector(".popup_opened"))}console.dir(document.querySelector(".popup__input")),O.addEventListener("click",(function(e){U(k),n(k,s({},t))})),_.addEventListener("click",(function(){U(p),b.value=y.textContent,S.value=v.textContent})),h.addEventListener("click",(function(){U(f),n(f,s({},t))})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=B,fetch("".concat(u.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:u.headers,body:JSON.stringify({})}).then(o)).then((function(){N.remove(),D(P)})).catch((function(e){c(e)}))}));var B,N,J,I,M,H,z=document.querySelector("#card").content,V=document.querySelector(".elements"),$=z.querySelector(".element"),F=document.querySelector(".popup__image"),G=($.querySelector(".element__image"),$.querySelector(".element__title"),document.querySelector(".popup__title"));function K(e){var t=$.cloneNode(!0),n=t.querySelector(".element__image"),r=t.querySelector(".element__title"),a=t.querySelector(".element__like-button"),i=t.querySelector(".element__delete-button"),l=t.querySelector(".element__like-count");if(e.owner._id!==J&&i.remove(),0!==e.likes.length)for(var s=0;s<e.likes.length;s++)e.likes[s]._id===J&&a.classList.add("element__like-button_active");return a.addEventListener("click",(function(t){var n;a.classList.contains("element__like-button_active")?function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers,body:JSON.stringify({})}).then(o)}(e._id).then((function(e){console.log(e.likes.length),a.classList.remove("element__like-button_active"),l.textContent=e.likes.length})).catch((function(e){c(e)})):(n=e._id,fetch("".concat(u.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:u.headers,body:JSON.stringify({})}).then(o)).then((function(e){console.log(e.likes.length),l.textContent=e.likes.length,a.classList.add("element__like-button_active")})).catch((function(e){c(e)}))})),i.addEventListener("click",(function(e){N=e.target.closest(".element"),B=N.id,U(P)})),n.addEventListener("click",(function(e){F.src=e.target.src,F.alt=e.target.alt,G.textContent=r.textContent,U(m)})),n.src=e.link,n.alt=e.name,r.textContent=e.name,l.textContent=e.likes.length,t.id=e._id,t}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}I=t,document.querySelectorAll(I.formSelector).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r(n,o,t),n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){e.validity.valid?function(e,t){var n=e.nextElementSibling;e.classList.remove(t.inputErrorClass),n.classList.remove(t.errorElementClass),n.textContent=""}(e,t):function(e,t,n){var r=e.nextElementSibling;e.classList.add(t.inputErrorClass),r.textContent=n,r.classList.add(t.errorElementClass)}(e,t,e.validationMessage)}(e,t),r(n,o,t)}))}))}(e,I)})),E.addEventListener("submit",(function(e){e.preventDefault(),a(e);var t,n,r=b.value,l=S.value;(t=r,n=l,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t,about:n})}).then(o)).then((function(){y.textContent=r,v.textContent=l,D(p)})).catch((function(e){c(e)})).finally((function(){return i(e)}))})),C.addEventListener("submit",(function(e){e.preventDefault();var t,n={name:g.value,link:q.value,likes:[],owner:{_id:J}};a(e),(t=n,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify(t)}).then(o)).then((function(e){n._id=e._id,function(e){V.prepend(K(e))}(n),D(f),C.reset()})).catch((function(e){c(e)})).finally((function(){return i(e)}))})),j.addEventListener("submit",(function(e){e.preventDefault();var t,n=w.value;a(e),(t=n,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then(o)).then((function(){L.src=n,D(k),j.reset()})).catch((function(e){c(e)})).finally((function(){return i(e)}))})),function(e){A.forEach((function(t){t.addEventListener("mousedown",(function(n){n.target.classList.contains(e.popupClass)&&D(t),n.target.classList.contains(e.buttonCloseClass)&&D(t)}))}))}(t),Promise.all([void(M="".concat(u.baseUrl,"/users/me"),H={headers:u.headers},fetch(M,H)).then(o),fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then(o)]).then((function(e){var t,n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),r=n[0],o=n[1];!function(e){y.textContent=e.name,v.textContent=e.about,L.src=e.avatar,J=e._id}(r),t=o,Object.keys(t).forEach((function(e){V.append(K(t[e]))}))})).catch((function(e){c(e)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cm9qZWN0LWJvb3RjYW1wL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL21lc3RvLXByb2plY3QtYm9vdGNhbXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtYm9vdGNhbXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWJvb3RjYW1wLy4vc3JjL2NvbXBvbmVudHMvdmFsaWRhdGUuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1ib290Y2FtcC8uL3NyYy9jb21wb25lbnRzL3V0aWxzLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtYm9vdGNhbXAvLi9zcmMvY29tcG9uZW50cy9hcGkuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1ib290Y2FtcC8uL3NyYy9jb21wb25lbnRzL21vZGFsLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtYm9vdGNhbXAvLi9zcmMvY29tcG9uZW50cy9jYXJkLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtYm9vdGNhbXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCBzZXR0aW5ncyA9IHtcclxuICBmb3JtU2VsZWN0b3I6ICcucG9wdXBfX2Zvcm0nLFxyXG4gIGZpZWxkc2V0U2VsZWN0b3I6ICdwb3B1cF9fZmllbGRzZXQnLFxyXG4gIGlucHV0U2VsZWN0b3I6ICcucG9wdXBfX2lucHV0JyxcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJy5wb3B1cF9fYnV0dG9uLXNhdmUnLFxyXG4gIGVycm9yRWxlbWVudFNlbGVjdG9yOiAnLnBvcHVwX19zcGFuLWVycm9yX2FjdGl2ZScsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogJ3BvcHVwX19idXR0b24tc2F2ZV9kaXNhYmxlZCcsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiAncG9wdXBfX2lucHV0X2Vycm9yJyxcclxuICBlcnJvckVsZW1lbnRDbGFzczogJ3BvcHVwX19zcGFuLWVycm9yX2FjdGl2ZScsXHJcbiAgYnV0dG9uQ2xvc2VDbGFzczogJ3BvcHVwX19idXR0b24tY2xvc2UnLFxyXG4gIHBvcHVwQ2xhc3M6ICdwb3B1cCcsXHJcbn07XHJcblxyXG5mdW5jdGlvbiBkaXNhYmxlU2F2ZUJ1dHRvbihwb3B1cCwgc2VsZWN0b3JzKSB7XHJcbiAgY29uc3QgZm9ybUVsZW1lbnQgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9ycy5mb3JtU2VsZWN0b3IpO1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9ycy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgaWYgKHBvcHVwLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JzLmlucHV0U2VsZWN0b3IpICYmICFmb3JtRWxlbWVudC5jaGVja1ZhbGlkaXR5KCkpIHtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZWxlY3RvcnMuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgc2VsZWN0b3JzLCBlcnJvck1lc3NhZ2UpIHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBpbnB1dEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHNlbGVjdG9ycy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCgoc2VsZWN0b3JzLmVycm9yRWxlbWVudENsYXNzKSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBoaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIHNlbGVjdG9ycykge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGlucHV0RWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2VsZWN0b3JzLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2VsZWN0b3JzLmVycm9yRWxlbWVudENsYXNzKTtcclxuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSAnJztcclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCwgc2VsZWN0b3JzKSB7XHJcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgIHNob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgc2VsZWN0b3JzLCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIHNlbGVjdG9ycyk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSB7XHJcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNlbGVjdG9ycykge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHNlbGVjdG9ycy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2VsZWN0b3JzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIHNlbGVjdG9ycykge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMuaW5wdXRTZWxlY3RvcikpO1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9ycy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZWxlY3RvcnMpO1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCwgc2VsZWN0b3JzKTtcclxuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZWxlY3RvcnMpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGVuYWJsZVZhbGlkYXRpb24oc2VsZWN0b3JzKSB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycy5mb3JtU2VsZWN0b3IpO1xyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgc2VsZWN0b3JzKTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IHtcclxuICBzZXR0aW5ncyxcclxuICBkaXNhYmxlU2F2ZUJ1dHRvbixcclxuICBlbmFibGVWYWxpZGF0aW9uXHJcbn07IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuZnVuY3Rpb24gY2hlY2tSZXNwb25zZShyZXMpIHtcclxuICBpZiAocmVzLm9rKSB7XHJcbiAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICB9XHJcbiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQntGI0LjQsdC60LA6ICR7cmVzLnN0YXR1c31gKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tFcnJvcihlcnIpIHtcclxuICBjb25zb2xlLmxvZyhlcnIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB3YWl0U2F2aW5nKGV2ZW50KSB7XHJcbiAgY29uc3QgaXRlbSA9IGV2ZW50LnN1Ym1pdHRlcjtcclxuICBpdGVtLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC10L3QuNC1Li4uJztcclxuICBpdGVtLmRpc2FibGVkID0gdHJ1ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gc3RvcFNhdmluZyhldmVudCkge1xyXG4gIGNvbnN0IGl0ZW0gPSBldmVudC5zdWJtaXR0ZXI7XHJcbiAgaXRlbS50ZXh0Q29udGVudCA9ICfQodC+0YXRgNCw0L3QuNGC0YwnO1xyXG4gIGl0ZW0uZGlzYWJsZWQgPSBmYWxzZTtcclxufVxyXG5cclxuZXhwb3J0IHtcclxuICBjaGVja0Vycm9yLFxyXG4gIGNoZWNrUmVzcG9uc2UsXHJcbiAgd2FpdFNhdmluZyxcclxuICBzdG9wU2F2aW5nXHJcbn07IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IHtcclxuICBjaGVja1Jlc3BvbnNlXHJcbn0gZnJvbSAnLi91dGlscy5qcyc7XHJcblxyXG5jb25zdCBjb25maWcgPSB7XHJcbiAgYmFzZVVybDogJ2h0dHBzOi8vbm9tb3JlcGFydGllcy5jby92MS93YmMtY29ob3J0LTEnLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246ICdmNjlhOGUxYS03YjRjLTQ4OTgtOWYzMy05NzUzOWRjYTNjMGMnLFxyXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gIH0sXHJcbn07XHJcblxyXG5cclxuZnVuY3Rpb24gcmVxdWVzdCh1cmwsIG9wdGlvbnMpIHtcclxuICByZXR1cm4gZmV0Y2godXJsLCBvcHRpb25zKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGdldFVzZXJJbmZvKCkge1xyXG4gIHJlcXVlc3QoYCR7Y29uZmlnLmJhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcclxuICB9KVxyXG4gICAgLnRoZW4oY2hlY2tSZXNwb25zZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldENhcmRzKCkge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVyc1xyXG4gIH0pXHJcbiAgICAudGhlbihjaGVja1Jlc3BvbnNlKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIHBhdGNoUHJvZmlsZShmdWxsbmFtZSwgcHJvZmVzc2lvbikge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBtZXRob2Q6ICdQQVRDSCcsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgbmFtZTogZnVsbG5hbWUsXHJcbiAgICAgIGFib3V0OiBwcm9mZXNzaW9uXHJcbiAgICB9KVxyXG4gIH0pXHJcbiAgICAudGhlbihjaGVja1Jlc3BvbnNlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGF0Y2hBdmF0YXIobGluaykge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGF2YXRhcjogbGlua1xyXG4gICAgfSlcclxuICB9KVxyXG4gICAgLnRoZW4oY2hlY2tSZXNwb25zZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldE5ld0NhcmQob2JqKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShvYmopXHJcbiAgfSlcclxuICAgIC50aGVuKGNoZWNrUmVzcG9uc2UpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwdXRMaWtlKGNhcmRJZCkge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgbWV0aG9kOiAnUFVUJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgfSlcclxuICB9KVxyXG4gICAgLnRoZW4oY2hlY2tSZXNwb25zZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlbGV0ZUxpa2UoY2FyZElkKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICB9KVxyXG4gIH0pXHJcbiAgICAudGhlbihjaGVja1Jlc3BvbnNlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgIH0pXHJcbiAgfSlcclxuICAgIC50aGVuKGNoZWNrUmVzcG9uc2UpO1xyXG59XHJcblxyXG5leHBvcnQge1xyXG4gIGdldFVzZXJJbmZvLFxyXG4gIHBhdGNoUHJvZmlsZSxcclxuICBwYXRjaEF2YXRhcixcclxuICBnZXROZXdDYXJkLFxyXG4gIGRlbGV0ZUNhcmQsXHJcbiAgcHV0TGlrZSxcclxuICBkZWxldGVMaWtlLFxyXG4gIGdldENhcmRzLFxyXG59OyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IHByb2ZpbGVQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZWRpdC1wcm9maWxlJyk7XHJcbmNvbnN0IGNhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fYWRkLWNhcmQnKTtcclxuY29uc3QgaW1hZ2VQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fdmlldy1pbWFnZScpO1xyXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xyXG5jb25zdCBwcm9maWxlUHJvZmVzc2lvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19zdWJ0aXRsZScpO1xyXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xyXG5jb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2FkZC1idXR0b24nKTtcclxuY29uc3QgaW5wdXRGdWxsTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJmdWxsbmFtZVwiXScpO1xyXG5jb25zdCBpbnB1dFByb2Zlc3Npb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwicHJvZmVzc2lvblwiXScpO1xyXG5jb25zdCBhZGRJbWFnZU5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJpbWFnZS1uYW1lXCJdJyk7XHJcbmNvbnN0IGFkZEltYWdlTGlua0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cImltYWdlLWxpbmtcIl0nKTtcclxuY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybVtuYW1lPVwiZWRpdC1mb3JtXCJdJyk7XHJcbmNvbnN0IGFkZEltYWdlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bbmFtZT1cImFkZC1mb3JtXCJdJyk7XHJcbmNvbnN0IHVwZGF0ZUF2YXRhclBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX191cGRhdGUtYXZhdGFyJyk7XHJcbmNvbnN0IGF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2F2YXRhci1pbWFnZScpO1xyXG5jb25zdCBhdmF0YXJQcm9maWxlVXBkYXRlQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3VwZGF0ZS1jb250YWluZXInKTtcclxuY29uc3QgdXBkYXRlQXZhdGFyRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bbmFtZT1cInVwZGF0ZS1hdmF0YXItZm9ybVwiXScpO1xyXG5jb25zdCBhdmF0YXJMaW5rSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwiYXZhdGFyLWxpbmtcIl0nKTtcclxuY29uc3QgZGVsZXRlQ2FyZEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW25hbWU9XCJkZWxldGUtY2FyZC1mb3JtXCJdJyk7XHJcbmNvbnN0IGRlbGV0ZUNhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZGVsZXRlLWNhcmQnKTtcclxuY29uc3QgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwJyk7XHJcblxyXG5pbXBvcnQge1xyXG4gIGRpc2FibGVTYXZlQnV0dG9uLFxyXG4gIHNldHRpbmdzXHJcbn0gZnJvbSAnLi92YWxpZGF0ZS5qcyc7XHJcblxyXG5pbXBvcnQge1xyXG4gIGNhcmRMaXN0LFxyXG4gIGNyZWF0ZUNhcmQsXHJcbiAgZWxlbUlkLFxyXG4gIHRhcmdldEVsZW1lbnRcclxufSBmcm9tICcuL2NhcmQuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBwYXRjaFByb2ZpbGUsXHJcbiAgcGF0Y2hBdmF0YXIsXHJcbiAgZ2V0TmV3Q2FyZCxcclxuICBkZWxldGVDYXJkXHJcbn0gZnJvbSAnLi9hcGkuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBteUlkXHJcbn0gZnJvbSAnLi4vaW5kZXguanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBjaGVja0Vycm9yLFxyXG4gIHdhaXRTYXZpbmcsXHJcbiAgc3RvcFNhdmluZ1xyXG59IGZyb20gJy4vdXRpbHMuanMnO1xyXG5jb25zb2xlLmRpcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2lucHV0JykpO1xyXG5cclxuZnVuY3Rpb24gcHJlcGVuZE5ld0NhcmQocmVzdWx0KSB7XHJcbiAgY2FyZExpc3QucHJlcGVuZChjcmVhdGVDYXJkKHJlc3VsdCkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvcGVuUG9wdXAocG9wdXApIHtcclxuICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9vcGVuZWQnKTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgY2xvc2ViQnlFc2NhcGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZVBvcHVwKHBvcHVwKSB7XHJcbiAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfb3BlbmVkJyk7XHJcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGNsb3NlYkJ5RXNjYXBlKTtcclxufVxyXG5cclxuYXZhdGFyUHJvZmlsZVVwZGF0ZUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICBvcGVuUG9wdXAodXBkYXRlQXZhdGFyUG9wdXApO1xyXG4gIGRpc2FibGVTYXZlQnV0dG9uKHVwZGF0ZUF2YXRhclBvcHVwLCB7IC4uLnNldHRpbmdzIH0pO1xyXG59KTtcclxuXHJcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIG9wZW5Qb3B1cChwcm9maWxlUG9wdXApO1xyXG4gIGlucHV0RnVsbE5hbWUudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcclxuICBpbnB1dFByb2Zlc3Npb24udmFsdWUgPSBwcm9maWxlUHJvZmVzc2lvbi50ZXh0Q29udGVudDtcclxufSk7XHJcblxyXG5hZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIG9wZW5Qb3B1cChjYXJkUG9wdXApO1xyXG4gIGRpc2FibGVTYXZlQnV0dG9uKGNhcmRQb3B1cCwgeyAuLi5zZXR0aW5ncyB9KTtcclxufSk7XHJcblxyXG5kZWxldGVDYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgZGVsZXRlQ2FyZChlbGVtSWQpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIHRhcmdldEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgIGNsb3NlUG9wdXAoZGVsZXRlQ2FyZFBvcHVwKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjaGVja0Vycm9yKGVycik7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5mdW5jdGlvbiBzZXRQb3B1cENsb3NlRXZlbnRMaXN0ZW5lcnMoc2VsZWN0b3JzKSB7XHJcbiAgcG9wdXBzLmZvckVhY2goKHBvcHVwKSA9PiB7XHJcbiAgICBwb3B1cC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhzZWxlY3RvcnMucG9wdXBDbGFzcykpIHtcclxuICAgICAgICBjbG9zZVBvcHVwKHBvcHVwKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoc2VsZWN0b3JzLmJ1dHRvbkNsb3NlQ2xhc3MpKSB7XHJcbiAgICAgICAgY2xvc2VQb3B1cChwb3B1cCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZWJCeUVzY2FwZShldnQpIHtcclxuICBpZiAoZXZ0LmNvZGUgPT09ICdFc2NhcGUnKSB7XHJcbiAgICBjb25zdCBvcGVuZWRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9vcGVuZWQnKTtcclxuICAgIGNsb3NlUG9wdXAob3BlbmVkUG9wdXApO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0U3VibWl0SGFubGVycygpIHtcclxuICBwcm9maWxlRWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xyXG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB3YWl0U2F2aW5nKGV2dCk7XHJcbiAgICBjb25zdCBuYW1lID0gaW5wdXRGdWxsTmFtZS52YWx1ZTtcclxuICAgIGNvbnN0IGFib3V0ID0gaW5wdXRQcm9mZXNzaW9uLnZhbHVlO1xyXG4gICAgcGF0Y2hQcm9maWxlKG5hbWUsIGFib3V0KVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgICAgIHByb2ZpbGVQcm9mZXNzaW9uLnRleHRDb250ZW50ID0gYWJvdXQ7XHJcbiAgICAgICAgY2xvc2VQb3B1cChwcm9maWxlUG9wdXApO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNoZWNrRXJyb3IoZXJyKTtcclxuICAgICAgfSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4gc3RvcFNhdmluZyhldnQpKTtcclxuICB9KTtcclxuICBhZGRJbWFnZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xyXG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCBvYmpDYXJkID0ge1xyXG4gICAgICBuYW1lOiBhZGRJbWFnZU5hbWVJbnB1dC52YWx1ZSxcclxuICAgICAgbGluazogYWRkSW1hZ2VMaW5rSW5wdXQudmFsdWUsXHJcbiAgICAgIGxpa2VzOiBbXSxcclxuICAgICAgb3duZXI6IHtcclxuICAgICAgICBfaWQ6IG15SWQsXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gICAgd2FpdFNhdmluZyhldnQpO1xyXG4gICAgZ2V0TmV3Q2FyZChvYmpDYXJkKVxyXG4gICAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgb2JqQ2FyZC5faWQgPSByZXN1bHQuX2lkO1xyXG4gICAgICAgIHByZXBlbmROZXdDYXJkKG9iakNhcmQpO1xyXG4gICAgICAgIGNsb3NlUG9wdXAoY2FyZFBvcHVwKTtcclxuICAgICAgICBhZGRJbWFnZUZvcm0ucmVzZXQoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjaGVja0Vycm9yKGVycik7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5maW5hbGx5KCgpID0+IHN0b3BTYXZpbmcoZXZ0KSk7XHJcbiAgfSk7XHJcbiAgdXBkYXRlQXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IGlucHV0ID0gYXZhdGFyTGlua0lucHV0LnZhbHVlO1xyXG4gICAgd2FpdFNhdmluZyhldnQpO1xyXG4gICAgcGF0Y2hBdmF0YXIoaW5wdXQpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBhdmF0YXJJbWFnZS5zcmMgPSBpbnB1dDtcclxuICAgICAgICBjbG9zZVBvcHVwKHVwZGF0ZUF2YXRhclBvcHVwKTtcclxuICAgICAgICB1cGRhdGVBdmF0YXJGb3JtLnJlc2V0KCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY2hlY2tFcnJvcihlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgICAuZmluYWxseSgoKSA9PiBzdG9wU2F2aW5nKGV2dCkpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQge1xyXG4gIHByb2ZpbGVQb3B1cCxcclxuICBjYXJkUG9wdXAsXHJcbiAgaW1hZ2VQb3B1cCxcclxuICBwcm9maWxlTmFtZSxcclxuICBwcm9maWxlUHJvZmVzc2lvbixcclxuICBhZGRJbWFnZU5hbWVJbnB1dCxcclxuICBhZGRJbWFnZUxpbmtJbnB1dCxcclxuICBhdmF0YXJMaW5rSW5wdXQsXHJcbiAgYXZhdGFySW1hZ2UsXHJcbiAgb3BlblBvcHVwLFxyXG4gIGNsb3NlUG9wdXAsXHJcbiAgc2V0U3VibWl0SGFubGVycyxcclxuICBkZWxldGVDYXJkUG9wdXAsXHJcbiAgZGVsZXRlQ2FyZEZvcm0sXHJcbiAgc2V0UG9wdXBDbG9zZUV2ZW50TGlzdGVuZXJzXHJcbn07IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IHtcclxuICBvcGVuUG9wdXAsXHJcbiAgaW1hZ2VQb3B1cCxcclxuICBkZWxldGVDYXJkUG9wdXAsXHJcbn0gZnJvbSAnLi9tb2RhbCc7XHJcblxyXG5pbXBvcnQge1xyXG4gIHB1dExpa2UsXHJcbiAgZGVsZXRlTGlrZSxcclxufSBmcm9tICcuL2FwaS5qcyc7XHJcblxyXG5pbXBvcnQge1xyXG4gIG15SWRcclxufSBmcm9tICcuLi9pbmRleC5qcyc7XHJcblxyXG5pbXBvcnQge1xyXG59IGZyb20gJy4vdmFsaWRhdGUuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBjaGVja0Vycm9yLFxyXG59IGZyb20gJy4vdXRpbHMuanMnO1xyXG5cclxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NhcmQnKS5jb250ZW50O1xyXG5jb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbGVtZW50cycpO1xyXG5jb25zdCBjYXJkID0gY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5lbGVtZW50Jyk7XHJcbmNvbnN0IGltYWdlUG9wdXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW1hZ2UnKTtcclxuY29uc3QgaW1hZ2VDYXJkID0gY2FyZC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9faW1hZ2UnKTtcclxuY29uc3QgdGl0bGVDYXJkID0gY2FyZC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fdGl0bGUnKTtcclxuY29uc3QgaW1hZ2VQb3B1cFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX190aXRsZScpO1xyXG5cclxuZnVuY3Rpb24gYWRkSW5pdGlhbENhcmRzKGFycikge1xyXG4gIE9iamVjdC5rZXlzKGFycikuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgY2FyZExpc3QuYXBwZW5kKGNyZWF0ZUNhcmQoYXJyW2l0ZW1dKSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmxldCBlbGVtSWQ7XHJcbmxldCB0YXJnZXRFbGVtZW50O1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2FyZChpdGVtKSB7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmNsb25lTm9kZSh0cnVlKSxcclxuICAgIGltYWdlQ2FyZEVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9faW1hZ2UnKSxcclxuICAgIHRpdGxlQ2FyZEVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fdGl0bGUnKSxcclxuICAgIGxpa2VCdXR0b25DYXJkRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbGVtZW50X19saWtlLWJ1dHRvbicpLFxyXG4gICAgZGVsZXRlQnV0dG9uQ2FyZEVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fZGVsZXRlLWJ1dHRvbicpLFxyXG4gICAgbGlrZUNvdW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmVsZW1lbnRfX2xpa2UtY291bnQnKTtcclxuICBpZiAoaXRlbS5vd25lci5faWQgIT09IG15SWQpIHtcclxuICAgIGRlbGV0ZUJ1dHRvbkNhcmRFbGVtZW50LnJlbW92ZSgpO1xyXG4gIH1cclxuICBpZiAoaXRlbS5saWtlcy5sZW5ndGggIT09IDApIHtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbS5saWtlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAoaXRlbS5saWtlc1tpXS5faWQgPT09IG15SWQpIHtcclxuICAgICAgICBsaWtlQnV0dG9uQ2FyZEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgbGlrZUJ1dHRvbkNhcmRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xyXG4gICAgaWYgKCFsaWtlQnV0dG9uQ2FyZEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmUnKSkge1xyXG4gICAgICBwdXRMaWtlKGl0ZW0uX2lkKVxyXG4gICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5saWtlcy5sZW5ndGgpO1xyXG4gICAgICAgICAgbGlrZUNvdW50LnRleHRDb250ZW50ID0gcmVzdWx0Lmxpa2VzLmxlbmd0aDtcclxuICAgICAgICAgIGxpa2VCdXR0b25DYXJkRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmUnKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICBjaGVja0Vycm9yKGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgZGVsZXRlTGlrZShpdGVtLl9pZClcclxuICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQubGlrZXMubGVuZ3RoKTtcclxuICAgICAgICAgIGxpa2VCdXR0b25DYXJkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmUnKTtcclxuICAgICAgICAgIGxpa2VDb3VudC50ZXh0Q29udGVudCA9IHJlc3VsdC5saWtlcy5sZW5ndGg7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgY2hlY2tFcnJvcihlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIGRlbGV0ZUJ1dHRvbkNhcmRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xyXG4gICAgdGFyZ2V0RWxlbWVudCA9IGV2dC50YXJnZXQuY2xvc2VzdCgnLmVsZW1lbnQnKTtcclxuICAgIGVsZW1JZCA9IHRhcmdldEVsZW1lbnQuaWQ7XHJcbiAgICBvcGVuUG9wdXAoZGVsZXRlQ2FyZFBvcHVwKTtcclxuXHJcbiAgfSk7XHJcbiAgaW1hZ2VDYXJkRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICAgIGltYWdlUG9wdXBJbWFnZS5zcmMgPSBldnQudGFyZ2V0LnNyYztcclxuICAgIGltYWdlUG9wdXBJbWFnZS5hbHQgPSBldnQudGFyZ2V0LmFsdDtcclxuICAgIGltYWdlUG9wdXBUaXRsZS50ZXh0Q29udGVudCA9IHRpdGxlQ2FyZEVsZW1lbnQudGV4dENvbnRlbnQ7XHJcbiAgICBvcGVuUG9wdXAoaW1hZ2VQb3B1cCk7XHJcbiAgfSk7XHJcbiAgaW1hZ2VDYXJkRWxlbWVudC5zcmMgPSBpdGVtLmxpbms7XHJcbiAgaW1hZ2VDYXJkRWxlbWVudC5hbHQgPSBpdGVtLm5hbWU7XHJcbiAgdGl0bGVDYXJkRWxlbWVudC50ZXh0Q29udGVudCA9IGl0ZW0ubmFtZTtcclxuICBsaWtlQ291bnQudGV4dENvbnRlbnQgPSBpdGVtLmxpa2VzLmxlbmd0aDtcclxuICBjYXJkRWxlbWVudC5pZCA9IGl0ZW0uX2lkO1xyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZXhwb3J0IHtcclxuICBjYXJkVGVtcGxhdGUsXHJcbiAgY2FyZExpc3QsXHJcbiAgY2FyZCxcclxuICBpbWFnZUNhcmQsXHJcbiAgdGl0bGVDYXJkLFxyXG4gIGFkZEluaXRpYWxDYXJkcyxcclxuICBjcmVhdGVDYXJkLFxyXG4gIGVsZW1JZCxcclxuICB0YXJnZXRFbGVtZW50XHJcbn07IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IFwiLi9wYWdlcy9pbmRleC5jc3NcIjtcclxuXHJcbmltcG9ydCB7XHJcbiAgYWRkSW5pdGlhbENhcmRzLFxyXG59IGZyb20gJy4vY29tcG9uZW50cy9jYXJkLmpzJztcclxuXHJcbmltcG9ydCB7XHJcbn0gZnJvbSAnLi9jb21wb25lbnRzL3V0aWxzLmpzJztcclxuXHJcbmltcG9ydCB7XHJcbiAgc2V0U3VibWl0SGFubGVycyxcclxuICBwcm9maWxlTmFtZSxcclxuICBwcm9maWxlUHJvZmVzc2lvbixcclxuICBhdmF0YXJJbWFnZSxcclxuICBzZXRQb3B1cENsb3NlRXZlbnRMaXN0ZW5lcnNcclxufSBmcm9tICcuL2NvbXBvbmVudHMvbW9kYWwuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBzZXR0aW5ncyxcclxuICBlbmFibGVWYWxpZGF0aW9uLFxyXG59IGZyb20gJy4vY29tcG9uZW50cy92YWxpZGF0ZS5qcyc7XHJcblxyXG5pbXBvcnQge1xyXG4gIGdldFVzZXJJbmZvLFxyXG4gIGdldENhcmRzLFxyXG59IGZyb20gJy4vY29tcG9uZW50cy9hcGkuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBjaGVja0Vycm9yXHJcbn0gZnJvbSAnLi9jb21wb25lbnRzL3V0aWxzLmpzJztcclxuXHJcbmxldCBteUlkO1xyXG5cclxuZnVuY3Rpb24gZ2V0VXNlckluZm9SZXN1bHQodXNlckRhdGEpIHtcclxuICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XHJcbiAgcHJvZmlsZVByb2Zlc3Npb24udGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcclxuICBhdmF0YXJJbWFnZS5zcmMgPSB1c2VyRGF0YS5hdmF0YXI7XHJcbiAgbXlJZCA9IHVzZXJEYXRhLl9pZDtcclxufVxyXG5cclxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XHJcblxyXG5zZXRTdWJtaXRIYW5sZXJzKCk7XHJcblxyXG5zZXRQb3B1cENsb3NlRXZlbnRMaXN0ZW5lcnMoc2V0dGluZ3MpO1xyXG5cclxuUHJvbWlzZS5hbGwoW2dldFVzZXJJbmZvKCksIGdldENhcmRzKCldKVxyXG4gIC50aGVuKChbdXNlckRhdGEsIGNhcmRzXSkgPT4ge1xyXG4gICAgZ2V0VXNlckluZm9SZXN1bHQodXNlckRhdGEpO1xyXG4gICAgYWRkSW5pdGlhbENhcmRzKGNhcmRzKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjaGVja0Vycm9yKGVycik7XHJcbiAgfSk7XHJcblxyXG5leHBvcnQge1xyXG4gIG15SWRcclxufTsiXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImZpZWxkc2V0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJlcnJvckVsZW1lbnRTZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckVsZW1lbnRDbGFzcyIsImJ1dHRvbkNsb3NlQ2xhc3MiLCJwb3B1cENsYXNzIiwiZGlzYWJsZVNhdmVCdXR0b24iLCJwb3B1cCIsInNlbGVjdG9ycyIsImZvcm1FbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImJ1dHRvbkVsZW1lbnQiLCJjaGVja1ZhbGlkaXR5IiwiY2xhc3NMaXN0IiwiYWRkIiwiZGlzYWJsZWQiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsInNvbWUiLCJpbnB1dEVsZW1lbnQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwicmVtb3ZlIiwiY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJjaGVja0Vycm9yIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIndhaXRTYXZpbmciLCJldmVudCIsIml0ZW0iLCJzdWJtaXR0ZXIiLCJ0ZXh0Q29udGVudCIsInN0b3BTYXZpbmciLCJjb25maWciLCJiYXNlVXJsIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJwcm9maWxlUG9wdXAiLCJkb2N1bWVudCIsImNhcmRQb3B1cCIsImltYWdlUG9wdXAiLCJwcm9maWxlTmFtZSIsInByb2ZpbGVQcm9mZXNzaW9uIiwicHJvZmlsZUVkaXRCdXR0b24iLCJhZGRDYXJkQnV0dG9uIiwiaW5wdXRGdWxsTmFtZSIsImlucHV0UHJvZmVzc2lvbiIsImFkZEltYWdlTmFtZUlucHV0IiwiYWRkSW1hZ2VMaW5rSW5wdXQiLCJwcm9maWxlRWRpdEZvcm0iLCJhZGRJbWFnZUZvcm0iLCJ1cGRhdGVBdmF0YXJQb3B1cCIsImF2YXRhckltYWdlIiwiYXZhdGFyUHJvZmlsZVVwZGF0ZUNvbnRhaW5lciIsInVwZGF0ZUF2YXRhckZvcm0iLCJhdmF0YXJMaW5rSW5wdXQiLCJkZWxldGVDYXJkRm9ybSIsImRlbGV0ZUNhcmRQb3B1cCIsInBvcHVwcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvcGVuUG9wdXAiLCJhZGRFdmVudExpc3RlbmVyIiwiY2xvc2ViQnlFc2NhcGUiLCJjbG9zZVBvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImNvZGUiLCJkaXIiLCJ2YWx1ZSIsImNhcmRJZCIsInByZXZlbnREZWZhdWx0IiwiZWxlbUlkIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInRoZW4iLCJ0YXJnZXRFbGVtZW50IiwiY2F0Y2giLCJteUlkIiwidXJsIiwib3B0aW9ucyIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjYXJkTGlzdCIsImNhcmQiLCJpbWFnZVBvcHVwSW1hZ2UiLCJpbWFnZVBvcHVwVGl0bGUiLCJjcmVhdGVDYXJkIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJpbWFnZUNhcmRFbGVtZW50IiwidGl0bGVDYXJkRWxlbWVudCIsImxpa2VCdXR0b25DYXJkRWxlbWVudCIsImRlbGV0ZUJ1dHRvbkNhcmRFbGVtZW50IiwibGlrZUNvdW50Iiwib3duZXIiLCJfaWQiLCJsaWtlcyIsImxlbmd0aCIsImkiLCJjb250YWlucyIsImRlbGV0ZUxpa2UiLCJyZXN1bHQiLCJ0YXJnZXQiLCJjbG9zZXN0IiwiaWQiLCJzcmMiLCJhbHQiLCJsaW5rIiwibmFtZSIsImZvckVhY2giLCJBcnJheSIsImZyb20iLCJlcnJvckVsZW1lbnQiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJoaWRlSW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzZXRFdmVudExpc3RlbmVycyIsImZ1bGxuYW1lIiwicHJvZmVzc2lvbiIsImFib3V0IiwiZmluYWxseSIsIm9iakNhcmQiLCJwcmVwZW5kIiwicHJlcGVuZE5ld0NhcmQiLCJyZXNldCIsImlucHV0IiwiYXZhdGFyIiwic2V0UG9wdXBDbG9zZUV2ZW50TGlzdGVuZXJzIiwiYWxsIiwiYXJyIiwidXNlckRhdGEiLCJjYXJkcyIsImdldFVzZXJJbmZvUmVzdWx0Iiwia2V5cyIsImFwcGVuZCJdLCJzb3VyY2VSb290IjoiIn0=