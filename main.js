(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{M:()=>J});var t={formSelector:".popup__form",fieldsetSelector:"popup__fieldset",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",errorElementSelector:".popup__span-error_active",inactiveButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_error",errorElementClass:"popup__span-error_active",buttonCloseClass:"popup__button-close",popupClass:"popup"};function n(e,t){var n=e.querySelector(t.formSelector),r=e.querySelector(t.submitButtonSelector);e.querySelector(t.inputSelector)&&!n.checkValidity()&&(r.classList.add(t.inactiveButtonClass),r.disabled=!0)}function r(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(e){console.log(e)}function a(e){var t=e.submitter;t.textContent="Сохранение...",t.disabled=!0}function i(e){var t=e.submitter;t.textContent="Сохранить",t.disabled=!1}var u={baseUrl:"https://nomoreparties.co/v1/wbc-cohort-1",headers:{authorization:"f69a8e1a-7b4c-4898-9f33-97539dca3c0c","Content-Type":"application/json"}};function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=document.querySelector(".popup__edit-profile"),f=document.querySelector(".popup__add-card"),m=document.querySelector(".popup__view-image"),y=document.querySelector(".profile__title"),v=document.querySelector(".profile__subtitle"),_=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),b=document.querySelector('input[name="fullname"]'),S=document.querySelector('input[name="profession"]'),g=document.querySelector('input[name="image-name"]'),q=document.querySelector('input[name="image-link"]'),E=document.querySelector('form[name="edit-form"]'),C=document.querySelector('form[name="add-form"]'),k=document.querySelector(".popup__update-avatar"),L=document.querySelector(".profile__avatar-image"),O=document.querySelector(".profile__update-container"),j=document.querySelector('form[name="update-avatar-form"]'),w=document.querySelector('input[name="avatar-link"]'),x=document.querySelector('form[name="delete-card-form"]'),P=document.querySelector(".popup__delete-card"),A=document.querySelectorAll(".popup");function U(e){e.classList.add("popup_opened"),document.addEventListener("keydown",T)}function D(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",T)}function T(e){"Escape"===e.code&&D(document.querySelector(".popup_opened"))}console.dir(document.querySelector(".popup__input")),O.addEventListener("click",(function(e){U(k),n(k,s({},t))})),_.addEventListener("click",(function(){U(p),b.value=y.textContent,S.value=v.textContent})),h.addEventListener("click",(function(){U(f),n(f,s({},t))})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=B,fetch("".concat(u.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:u.headers,body:JSON.stringify({})}).then(o)).then((function(){N.remove(),D(P)})).catch((function(e){c(e)}))}));var B,N,J,I,M=document.querySelector("#card").content,H=document.querySelector(".elements"),z=M.querySelector(".element"),V=document.querySelector(".popup__image"),$=(z.querySelector(".element__image"),z.querySelector(".element__title"),document.querySelector(".popup__title"));function F(e){var t=z.cloneNode(!0),n=t.querySelector(".element__image"),r=t.querySelector(".element__title"),a=t.querySelector(".element__like-button"),i=t.querySelector(".element__delete-button"),l=t.querySelector(".element__like-count");if(e.owner._id!==J&&i.remove(),0!==e.likes.length)for(var s=0;s<e.likes.length;s++)e.likes[s]._id===J&&a.classList.add("element__like-button_active");return a.addEventListener("click",(function(t){var n;a.classList.contains("element__like-button_active")?function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers,body:JSON.stringify({})}).then(o)}(e._id).then((function(e){console.log(e.likes.length),a.classList.remove("element__like-button_active"),l.textContent=e.likes.length})).catch((function(e){c(e)})):(n=e._id,fetch("".concat(u.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:u.headers,body:JSON.stringify({})}).then(o)).then((function(e){console.log(e.likes.length),l.textContent=e.likes.length,a.classList.add("element__like-button_active")})).catch((function(e){c(e)}))})),i.addEventListener("click",(function(e){N=e.target.closest(".element"),B=N.id,U(P)})),n.addEventListener("click",(function(e){V.src=e.target.src,V.alt=e.target.alt,$.textContent=r.textContent,U(m)})),n.src=e.link,n.alt=e.name,r.textContent=e.name,l.textContent=e.likes.length,t.id=e._id,t}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}I=t,document.querySelectorAll(I.formSelector).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r(n,o,t),n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){e.validity.valid?function(e,t){var n=e.nextElementSibling;e.classList.remove(t.inputErrorClass),n.classList.remove(t.errorElementClass),n.textContent=""}(e,t):function(e,t,n){var r=e.nextElementSibling;e.classList.add(t.inputErrorClass),r.textContent=n,r.classList.add(t.errorElementClass)}(e,t,e.validationMessage)}(e,t),r(n,o,t)}))}))}(e,I)})),E.addEventListener("submit",(function(e){e.preventDefault(),a(e);var t,n,r=b.value,l=S.value;(t=r,n=l,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t,about:n})}).then(o)).then((function(){y.textContent=r,v.textContent=l,D(p)})).catch((function(e){c(e)})).finally((function(){return i(e)}))})),C.addEventListener("submit",(function(e){e.preventDefault();var t,n={name:g.value,link:q.value,likes:[],owner:{_id:J}};a(e),(t=n,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify(t)}).then(o)).then((function(e){n._id=e._id,function(e){H.prepend(F(e))}(n),D(f),C.reset()})).catch((function(e){c(e)})).finally((function(){return i(e)}))})),j.addEventListener("submit",(function(e){e.preventDefault();var t,n=w.value;a(e),(t=n,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then(o)).then((function(){L.src=n,D(k),j.reset()})).catch((function(e){c(e)})).finally((function(){return i(e)}))})),function(e){A.forEach((function(t){t.addEventListener("mousedown",(function(n){n.target.classList.contains(e.popupClass)&&D(t),n.target.classList.contains(e.buttonCloseClass)&&D(t)}))}))}(t),Promise.all([fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then(o),fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then(o)]).then((function(e){var t,n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),r=n[0],o=n[1];!function(e){y.textContent=e.name,v.textContent=e.about,L.src=e.avatar,J=e._id}(r),t=o,Object.keys(t).forEach((function(e){H.append(F(t[e]))}))})).catch((function(e){c(e)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YnBhY2s6Ly9tZXN0by1wcm9qZWN0LWJvb3RjYW1wL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWJvb3RjYW1wL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1ib290Y2FtcC8uL3NyYy9jb21wb25lbnRzL3ZhbGlkYXRlLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtYm9vdGNhbXAvLi9zcmMvY29tcG9uZW50cy91dGlscy5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWJvb3RjYW1wLy4vc3JjL2NvbXBvbmVudHMvYXBpLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtYm9vdGNhbXAvLi9zcmMvY29tcG9uZW50cy9tb2RhbC5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWJvb3RjYW1wLy4vc3JjL2NvbXBvbmVudHMvY2FyZC5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWJvb3RjYW1wLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3Qgc2V0dGluZ3MgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiAnLnBvcHVwX19mb3JtJyxcclxuICBmaWVsZHNldFNlbGVjdG9yOiAncG9wdXBfX2ZpZWxkc2V0JyxcclxuICBpbnB1dFNlbGVjdG9yOiAnLnBvcHVwX19pbnB1dCcsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcucG9wdXBfX2J1dHRvbi1zYXZlJyxcclxuICBlcnJvckVsZW1lbnRTZWxlY3RvcjogJy5wb3B1cF9fc3Bhbi1lcnJvcl9hY3RpdmUnLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6ICdwb3B1cF9fYnV0dG9uLXNhdmVfZGlzYWJsZWQnLFxyXG4gIGlucHV0RXJyb3JDbGFzczogJ3BvcHVwX19pbnB1dF9lcnJvcicsXHJcbiAgZXJyb3JFbGVtZW50Q2xhc3M6ICdwb3B1cF9fc3Bhbi1lcnJvcl9hY3RpdmUnLFxyXG4gIGJ1dHRvbkNsb3NlQ2xhc3M6ICdwb3B1cF9fYnV0dG9uLWNsb3NlJyxcclxuICBwb3B1cENsYXNzOiAncG9wdXAnLFxyXG59O1xyXG5cclxuZnVuY3Rpb24gZGlzYWJsZVNhdmVCdXR0b24ocG9wdXAsIHNlbGVjdG9ycykge1xyXG4gIGNvbnN0IGZvcm1FbGVtZW50ID0gcG9wdXAucXVlcnlTZWxlY3RvcihzZWxlY3RvcnMuZm9ybVNlbGVjdG9yKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gcG9wdXAucXVlcnlTZWxlY3RvcihzZWxlY3RvcnMuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIGlmIChwb3B1cC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9ycy5pbnB1dFNlbGVjdG9yKSAmJiAhZm9ybUVsZW1lbnQuY2hlY2tWYWxpZGl0eSgpKSB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoc2VsZWN0b3JzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIHNlbGVjdG9ycywgZXJyb3JNZXNzYWdlKSB7XHJcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gaW5wdXRFbGVtZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZWxlY3RvcnMuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQoKHNlbGVjdG9ycy5lcnJvckVsZW1lbnRDbGFzcykpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBzZWxlY3RvcnMpIHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBpbnB1dEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNlbGVjdG9ycy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNlbGVjdG9ycy5lcnJvckVsZW1lbnRDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQsIHNlbGVjdG9ycykge1xyXG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICBzaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIHNlbGVjdG9ycywgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBzZWxlY3RvcnMpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZWxlY3RvcnMpIHtcclxuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZWxlY3RvcnMuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICB9IGVsc2Uge1xyXG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNlbGVjdG9ycy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBzZWxlY3RvcnMpIHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JzLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvcnMuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2VsZWN0b3JzKTtcclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQsIHNlbGVjdG9ycyk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2VsZWN0b3JzKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBlbmFibGVWYWxpZGF0aW9uKHNlbGVjdG9ycykge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMuZm9ybVNlbGVjdG9yKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIHNlbGVjdG9ycyk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCB7XHJcbiAgc2V0dGluZ3MsXHJcbiAgZGlzYWJsZVNhdmVCdXR0b24sXHJcbiAgZW5hYmxlVmFsaWRhdGlvblxyXG59OyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmZ1bmN0aW9uIGNoZWNrUmVzcG9uc2UocmVzKSB7XHJcbiAgaWYgKHJlcy5vaykge1xyXG4gICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgfVxyXG4gIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrRXJyb3IoZXJyKSB7XHJcbiAgY29uc29sZS5sb2coZXJyKTtcclxufVxyXG5cclxuZnVuY3Rpb24gd2FpdFNhdmluZyhldmVudCkge1xyXG4gIGNvbnN0IGl0ZW0gPSBldmVudC5zdWJtaXR0ZXI7XHJcbiAgaXRlbS50ZXh0Q29udGVudCA9ICfQodC+0YXRgNCw0L3QtdC90LjQtS4uLic7XHJcbiAgaXRlbS5kaXNhYmxlZCA9IHRydWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0b3BTYXZpbmcoZXZlbnQpIHtcclxuICBjb25zdCBpdGVtID0gZXZlbnQuc3VibWl0dGVyO1xyXG4gIGl0ZW0udGV4dENvbnRlbnQgPSAn0KHQvtGF0YDQsNC90LjRgtGMJztcclxuICBpdGVtLmRpc2FibGVkID0gZmFsc2U7XHJcbn1cclxuXHJcbmV4cG9ydCB7XHJcbiAgY2hlY2tFcnJvcixcclxuICBjaGVja1Jlc3BvbnNlLFxyXG4gIHdhaXRTYXZpbmcsXHJcbiAgc3RvcFNhdmluZ1xyXG59OyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmltcG9ydCB7XHJcbiAgY2hlY2tSZXNwb25zZVxyXG59IGZyb20gJy4vdXRpbHMuanMnO1xyXG5cclxuY29uc3QgY29uZmlnID0ge1xyXG4gIGJhc2VVcmw6ICdodHRwczovL25vbW9yZXBhcnRpZXMuY28vdjEvd2JjLWNvaG9ydC0xJyxcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiAnZjY5YThlMWEtN2I0Yy00ODk4LTlmMzMtOTc1MzlkY2EzYzBjJyxcclxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICB9LFxyXG59O1xyXG5cclxuXHJcbi8vIGZ1bmN0aW9uIHJlcXVlc3QodXJsLCBvcHRpb25zKSB7XHJcbi8vICAgcmV0dXJuIGZldGNoKHVybCwgb3B0aW9ucyk7XHJcbi8vIH07XHJcblxyXG5mdW5jdGlvbiBnZXRVc2VySW5mbygpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcclxuICB9KVxyXG4gICAgLnRoZW4oY2hlY2tSZXNwb25zZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldENhcmRzKCkge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVyc1xyXG4gIH0pXHJcbiAgICAudGhlbihjaGVja1Jlc3BvbnNlKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIHBhdGNoUHJvZmlsZShmdWxsbmFtZSwgcHJvZmVzc2lvbikge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBtZXRob2Q6ICdQQVRDSCcsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgbmFtZTogZnVsbG5hbWUsXHJcbiAgICAgIGFib3V0OiBwcm9mZXNzaW9uXHJcbiAgICB9KVxyXG4gIH0pXHJcbiAgICAudGhlbihjaGVja1Jlc3BvbnNlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGF0Y2hBdmF0YXIobGluaykge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGF2YXRhcjogbGlua1xyXG4gICAgfSlcclxuICB9KVxyXG4gICAgLnRoZW4oY2hlY2tSZXNwb25zZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldE5ld0NhcmQob2JqKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShvYmopXHJcbiAgfSlcclxuICAgIC50aGVuKGNoZWNrUmVzcG9uc2UpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwdXRMaWtlKGNhcmRJZCkge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgbWV0aG9kOiAnUFVUJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgfSlcclxuICB9KVxyXG4gICAgLnRoZW4oY2hlY2tSZXNwb25zZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlbGV0ZUxpa2UoY2FyZElkKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICB9KVxyXG4gIH0pXHJcbiAgICAudGhlbihjaGVja1Jlc3BvbnNlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgIH0pXHJcbiAgfSlcclxuICAgIC50aGVuKGNoZWNrUmVzcG9uc2UpO1xyXG59XHJcblxyXG5leHBvcnQge1xyXG4gIGdldFVzZXJJbmZvLFxyXG4gIHBhdGNoUHJvZmlsZSxcclxuICBwYXRjaEF2YXRhcixcclxuICBnZXROZXdDYXJkLFxyXG4gIGRlbGV0ZUNhcmQsXHJcbiAgcHV0TGlrZSxcclxuICBkZWxldGVMaWtlLFxyXG4gIGdldENhcmRzLFxyXG59OyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IHByb2ZpbGVQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZWRpdC1wcm9maWxlJyk7XHJcbmNvbnN0IGNhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fYWRkLWNhcmQnKTtcclxuY29uc3QgaW1hZ2VQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fdmlldy1pbWFnZScpO1xyXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xyXG5jb25zdCBwcm9maWxlUHJvZmVzc2lvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19zdWJ0aXRsZScpO1xyXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xyXG5jb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2FkZC1idXR0b24nKTtcclxuY29uc3QgaW5wdXRGdWxsTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJmdWxsbmFtZVwiXScpO1xyXG5jb25zdCBpbnB1dFByb2Zlc3Npb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwicHJvZmVzc2lvblwiXScpO1xyXG5jb25zdCBhZGRJbWFnZU5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJpbWFnZS1uYW1lXCJdJyk7XHJcbmNvbnN0IGFkZEltYWdlTGlua0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cImltYWdlLWxpbmtcIl0nKTtcclxuY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybVtuYW1lPVwiZWRpdC1mb3JtXCJdJyk7XHJcbmNvbnN0IGFkZEltYWdlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bbmFtZT1cImFkZC1mb3JtXCJdJyk7XHJcbmNvbnN0IHVwZGF0ZUF2YXRhclBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX191cGRhdGUtYXZhdGFyJyk7XHJcbmNvbnN0IGF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2F2YXRhci1pbWFnZScpO1xyXG5jb25zdCBhdmF0YXJQcm9maWxlVXBkYXRlQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3VwZGF0ZS1jb250YWluZXInKTtcclxuY29uc3QgdXBkYXRlQXZhdGFyRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1bbmFtZT1cInVwZGF0ZS1hdmF0YXItZm9ybVwiXScpO1xyXG5jb25zdCBhdmF0YXJMaW5rSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwiYXZhdGFyLWxpbmtcIl0nKTtcclxuY29uc3QgZGVsZXRlQ2FyZEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW25hbWU9XCJkZWxldGUtY2FyZC1mb3JtXCJdJyk7XHJcbmNvbnN0IGRlbGV0ZUNhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZGVsZXRlLWNhcmQnKTtcclxuY29uc3QgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwJyk7XHJcblxyXG5pbXBvcnQge1xyXG4gIGRpc2FibGVTYXZlQnV0dG9uLFxyXG4gIHNldHRpbmdzXHJcbn0gZnJvbSAnLi92YWxpZGF0ZS5qcyc7XHJcblxyXG5pbXBvcnQge1xyXG4gIGNhcmRMaXN0LFxyXG4gIGNyZWF0ZUNhcmQsXHJcbiAgZWxlbUlkLFxyXG4gIHRhcmdldEVsZW1lbnRcclxufSBmcm9tICcuL2NhcmQuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBwYXRjaFByb2ZpbGUsXHJcbiAgcGF0Y2hBdmF0YXIsXHJcbiAgZ2V0TmV3Q2FyZCxcclxuICBkZWxldGVDYXJkXHJcbn0gZnJvbSAnLi9hcGkuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBteUlkXHJcbn0gZnJvbSAnLi4vaW5kZXguanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBjaGVja0Vycm9yLFxyXG4gIHdhaXRTYXZpbmcsXHJcbiAgc3RvcFNhdmluZ1xyXG59IGZyb20gJy4vdXRpbHMuanMnO1xyXG5jb25zb2xlLmRpcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2lucHV0JykpO1xyXG5cclxuZnVuY3Rpb24gcHJlcGVuZE5ld0NhcmQocmVzdWx0KSB7XHJcbiAgY2FyZExpc3QucHJlcGVuZChjcmVhdGVDYXJkKHJlc3VsdCkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvcGVuUG9wdXAocG9wdXApIHtcclxuICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9vcGVuZWQnKTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgY2xvc2ViQnlFc2NhcGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZVBvcHVwKHBvcHVwKSB7XHJcbiAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfb3BlbmVkJyk7XHJcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGNsb3NlYkJ5RXNjYXBlKTtcclxufVxyXG5cclxuYXZhdGFyUHJvZmlsZVVwZGF0ZUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICBvcGVuUG9wdXAodXBkYXRlQXZhdGFyUG9wdXApO1xyXG4gIGRpc2FibGVTYXZlQnV0dG9uKHVwZGF0ZUF2YXRhclBvcHVwLCB7IC4uLnNldHRpbmdzIH0pO1xyXG59KTtcclxuXHJcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIG9wZW5Qb3B1cChwcm9maWxlUG9wdXApO1xyXG4gIGlucHV0RnVsbE5hbWUudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcclxuICBpbnB1dFByb2Zlc3Npb24udmFsdWUgPSBwcm9maWxlUHJvZmVzc2lvbi50ZXh0Q29udGVudDtcclxufSk7XHJcblxyXG5hZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIG9wZW5Qb3B1cChjYXJkUG9wdXApO1xyXG4gIGRpc2FibGVTYXZlQnV0dG9uKGNhcmRQb3B1cCwgeyAuLi5zZXR0aW5ncyB9KTtcclxufSk7XHJcblxyXG5kZWxldGVDYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgZGVsZXRlQ2FyZChlbGVtSWQpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIHRhcmdldEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgIGNsb3NlUG9wdXAoZGVsZXRlQ2FyZFBvcHVwKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjaGVja0Vycm9yKGVycik7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5mdW5jdGlvbiBzZXRQb3B1cENsb3NlRXZlbnRMaXN0ZW5lcnMoc2VsZWN0b3JzKSB7XHJcbiAgcG9wdXBzLmZvckVhY2goKHBvcHVwKSA9PiB7XHJcbiAgICBwb3B1cC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhzZWxlY3RvcnMucG9wdXBDbGFzcykpIHtcclxuICAgICAgICBjbG9zZVBvcHVwKHBvcHVwKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoc2VsZWN0b3JzLmJ1dHRvbkNsb3NlQ2xhc3MpKSB7XHJcbiAgICAgICAgY2xvc2VQb3B1cChwb3B1cCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZWJCeUVzY2FwZShldnQpIHtcclxuICBpZiAoZXZ0LmNvZGUgPT09ICdFc2NhcGUnKSB7XHJcbiAgICBjb25zdCBvcGVuZWRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9vcGVuZWQnKTtcclxuICAgIGNsb3NlUG9wdXAob3BlbmVkUG9wdXApO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0U3VibWl0SGFubGVycygpIHtcclxuICBwcm9maWxlRWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xyXG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB3YWl0U2F2aW5nKGV2dCk7XHJcbiAgICBjb25zdCBuYW1lID0gaW5wdXRGdWxsTmFtZS52YWx1ZTtcclxuICAgIGNvbnN0IGFib3V0ID0gaW5wdXRQcm9mZXNzaW9uLnZhbHVlO1xyXG4gICAgcGF0Y2hQcm9maWxlKG5hbWUsIGFib3V0KVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgICAgIHByb2ZpbGVQcm9mZXNzaW9uLnRleHRDb250ZW50ID0gYWJvdXQ7XHJcbiAgICAgICAgY2xvc2VQb3B1cChwcm9maWxlUG9wdXApO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNoZWNrRXJyb3IoZXJyKTtcclxuICAgICAgfSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4gc3RvcFNhdmluZyhldnQpKTtcclxuICB9KTtcclxuICBhZGRJbWFnZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xyXG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCBvYmpDYXJkID0ge1xyXG4gICAgICBuYW1lOiBhZGRJbWFnZU5hbWVJbnB1dC52YWx1ZSxcclxuICAgICAgbGluazogYWRkSW1hZ2VMaW5rSW5wdXQudmFsdWUsXHJcbiAgICAgIGxpa2VzOiBbXSxcclxuICAgICAgb3duZXI6IHtcclxuICAgICAgICBfaWQ6IG15SWQsXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gICAgd2FpdFNhdmluZyhldnQpO1xyXG4gICAgZ2V0TmV3Q2FyZChvYmpDYXJkKVxyXG4gICAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgb2JqQ2FyZC5faWQgPSByZXN1bHQuX2lkO1xyXG4gICAgICAgIHByZXBlbmROZXdDYXJkKG9iakNhcmQpO1xyXG4gICAgICAgIGNsb3NlUG9wdXAoY2FyZFBvcHVwKTtcclxuICAgICAgICBhZGRJbWFnZUZvcm0ucmVzZXQoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjaGVja0Vycm9yKGVycik7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5maW5hbGx5KCgpID0+IHN0b3BTYXZpbmcoZXZ0KSk7XHJcbiAgfSk7XHJcbiAgdXBkYXRlQXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IGlucHV0ID0gYXZhdGFyTGlua0lucHV0LnZhbHVlO1xyXG4gICAgd2FpdFNhdmluZyhldnQpO1xyXG4gICAgcGF0Y2hBdmF0YXIoaW5wdXQpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBhdmF0YXJJbWFnZS5zcmMgPSBpbnB1dDtcclxuICAgICAgICBjbG9zZVBvcHVwKHVwZGF0ZUF2YXRhclBvcHVwKTtcclxuICAgICAgICB1cGRhdGVBdmF0YXJGb3JtLnJlc2V0KCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY2hlY2tFcnJvcihlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgICAuZmluYWxseSgoKSA9PiBzdG9wU2F2aW5nKGV2dCkpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQge1xyXG4gIHByb2ZpbGVQb3B1cCxcclxuICBjYXJkUG9wdXAsXHJcbiAgaW1hZ2VQb3B1cCxcclxuICBwcm9maWxlTmFtZSxcclxuICBwcm9maWxlUHJvZmVzc2lvbixcclxuICBhZGRJbWFnZU5hbWVJbnB1dCxcclxuICBhZGRJbWFnZUxpbmtJbnB1dCxcclxuICBhdmF0YXJMaW5rSW5wdXQsXHJcbiAgYXZhdGFySW1hZ2UsXHJcbiAgb3BlblBvcHVwLFxyXG4gIGNsb3NlUG9wdXAsXHJcbiAgc2V0U3VibWl0SGFubGVycyxcclxuICBkZWxldGVDYXJkUG9wdXAsXHJcbiAgZGVsZXRlQ2FyZEZvcm0sXHJcbiAgc2V0UG9wdXBDbG9zZUV2ZW50TGlzdGVuZXJzXHJcbn07IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IHtcclxuICBvcGVuUG9wdXAsXHJcbiAgaW1hZ2VQb3B1cCxcclxuICBkZWxldGVDYXJkUG9wdXAsXHJcbn0gZnJvbSAnLi9tb2RhbCc7XHJcblxyXG5pbXBvcnQge1xyXG4gIHB1dExpa2UsXHJcbiAgZGVsZXRlTGlrZSxcclxufSBmcm9tICcuL2FwaS5qcyc7XHJcblxyXG5pbXBvcnQge1xyXG4gIG15SWRcclxufSBmcm9tICcuLi9pbmRleC5qcyc7XHJcblxyXG5pbXBvcnQge1xyXG59IGZyb20gJy4vdmFsaWRhdGUuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBjaGVja0Vycm9yLFxyXG59IGZyb20gJy4vdXRpbHMuanMnO1xyXG5cclxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NhcmQnKS5jb250ZW50O1xyXG5jb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbGVtZW50cycpO1xyXG5jb25zdCBjYXJkID0gY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5lbGVtZW50Jyk7XHJcbmNvbnN0IGltYWdlUG9wdXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW1hZ2UnKTtcclxuY29uc3QgaW1hZ2VDYXJkID0gY2FyZC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9faW1hZ2UnKTtcclxuY29uc3QgdGl0bGVDYXJkID0gY2FyZC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fdGl0bGUnKTtcclxuY29uc3QgaW1hZ2VQb3B1cFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX190aXRsZScpO1xyXG5cclxuZnVuY3Rpb24gYWRkSW5pdGlhbENhcmRzKGFycikge1xyXG4gIE9iamVjdC5rZXlzKGFycikuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgY2FyZExpc3QuYXBwZW5kKGNyZWF0ZUNhcmQoYXJyW2l0ZW1dKSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmxldCBlbGVtSWQ7XHJcbmxldCB0YXJnZXRFbGVtZW50O1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2FyZChpdGVtKSB7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmNsb25lTm9kZSh0cnVlKSxcclxuICAgIGltYWdlQ2FyZEVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9faW1hZ2UnKSxcclxuICAgIHRpdGxlQ2FyZEVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fdGl0bGUnKSxcclxuICAgIGxpa2VCdXR0b25DYXJkRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbGVtZW50X19saWtlLWJ1dHRvbicpLFxyXG4gICAgZGVsZXRlQnV0dG9uQ2FyZEVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fZGVsZXRlLWJ1dHRvbicpLFxyXG4gICAgbGlrZUNvdW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmVsZW1lbnRfX2xpa2UtY291bnQnKTtcclxuICBpZiAoaXRlbS5vd25lci5faWQgIT09IG15SWQpIHtcclxuICAgIGRlbGV0ZUJ1dHRvbkNhcmRFbGVtZW50LnJlbW92ZSgpO1xyXG4gIH1cclxuICBpZiAoaXRlbS5saWtlcy5sZW5ndGggIT09IDApIHtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbS5saWtlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAoaXRlbS5saWtlc1tpXS5faWQgPT09IG15SWQpIHtcclxuICAgICAgICBsaWtlQnV0dG9uQ2FyZEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgbGlrZUJ1dHRvbkNhcmRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xyXG4gICAgaWYgKCFsaWtlQnV0dG9uQ2FyZEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmUnKSkge1xyXG4gICAgICBwdXRMaWtlKGl0ZW0uX2lkKVxyXG4gICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5saWtlcy5sZW5ndGgpO1xyXG4gICAgICAgICAgbGlrZUNvdW50LnRleHRDb250ZW50ID0gcmVzdWx0Lmxpa2VzLmxlbmd0aDtcclxuICAgICAgICAgIGxpa2VCdXR0b25DYXJkRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmUnKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICBjaGVja0Vycm9yKGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgZGVsZXRlTGlrZShpdGVtLl9pZClcclxuICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQubGlrZXMubGVuZ3RoKTtcclxuICAgICAgICAgIGxpa2VCdXR0b25DYXJkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmUnKTtcclxuICAgICAgICAgIGxpa2VDb3VudC50ZXh0Q29udGVudCA9IHJlc3VsdC5saWtlcy5sZW5ndGg7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgY2hlY2tFcnJvcihlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIGRlbGV0ZUJ1dHRvbkNhcmRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xyXG4gICAgdGFyZ2V0RWxlbWVudCA9IGV2dC50YXJnZXQuY2xvc2VzdCgnLmVsZW1lbnQnKTtcclxuICAgIGVsZW1JZCA9IHRhcmdldEVsZW1lbnQuaWQ7XHJcbiAgICBvcGVuUG9wdXAoZGVsZXRlQ2FyZFBvcHVwKTtcclxuXHJcbiAgfSk7XHJcbiAgaW1hZ2VDYXJkRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICAgIGltYWdlUG9wdXBJbWFnZS5zcmMgPSBldnQudGFyZ2V0LnNyYztcclxuICAgIGltYWdlUG9wdXBJbWFnZS5hbHQgPSBldnQudGFyZ2V0LmFsdDtcclxuICAgIGltYWdlUG9wdXBUaXRsZS50ZXh0Q29udGVudCA9IHRpdGxlQ2FyZEVsZW1lbnQudGV4dENvbnRlbnQ7XHJcbiAgICBvcGVuUG9wdXAoaW1hZ2VQb3B1cCk7XHJcbiAgfSk7XHJcbiAgaW1hZ2VDYXJkRWxlbWVudC5zcmMgPSBpdGVtLmxpbms7XHJcbiAgaW1hZ2VDYXJkRWxlbWVudC5hbHQgPSBpdGVtLm5hbWU7XHJcbiAgdGl0bGVDYXJkRWxlbWVudC50ZXh0Q29udGVudCA9IGl0ZW0ubmFtZTtcclxuICBsaWtlQ291bnQudGV4dENvbnRlbnQgPSBpdGVtLmxpa2VzLmxlbmd0aDtcclxuICBjYXJkRWxlbWVudC5pZCA9IGl0ZW0uX2lkO1xyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZXhwb3J0IHtcclxuICBjYXJkVGVtcGxhdGUsXHJcbiAgY2FyZExpc3QsXHJcbiAgY2FyZCxcclxuICBpbWFnZUNhcmQsXHJcbiAgdGl0bGVDYXJkLFxyXG4gIGFkZEluaXRpYWxDYXJkcyxcclxuICBjcmVhdGVDYXJkLFxyXG4gIGVsZW1JZCxcclxuICB0YXJnZXRFbGVtZW50XHJcbn07IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IFwiLi9wYWdlcy9pbmRleC5jc3NcIjtcclxuXHJcbmltcG9ydCB7XHJcbiAgYWRkSW5pdGlhbENhcmRzLFxyXG59IGZyb20gJy4vY29tcG9uZW50cy9jYXJkLmpzJztcclxuXHJcbmltcG9ydCB7XHJcbn0gZnJvbSAnLi9jb21wb25lbnRzL3V0aWxzLmpzJztcclxuXHJcbmltcG9ydCB7XHJcbiAgc2V0U3VibWl0SGFubGVycyxcclxuICBwcm9maWxlTmFtZSxcclxuICBwcm9maWxlUHJvZmVzc2lvbixcclxuICBhdmF0YXJJbWFnZSxcclxuICBzZXRQb3B1cENsb3NlRXZlbnRMaXN0ZW5lcnNcclxufSBmcm9tICcuL2NvbXBvbmVudHMvbW9kYWwuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBzZXR0aW5ncyxcclxuICBlbmFibGVWYWxpZGF0aW9uLFxyXG59IGZyb20gJy4vY29tcG9uZW50cy92YWxpZGF0ZS5qcyc7XHJcblxyXG5pbXBvcnQge1xyXG4gIGdldFVzZXJJbmZvLFxyXG4gIGdldENhcmRzLFxyXG59IGZyb20gJy4vY29tcG9uZW50cy9hcGkuanMnO1xyXG5cclxuaW1wb3J0IHtcclxuICBjaGVja0Vycm9yXHJcbn0gZnJvbSAnLi9jb21wb25lbnRzL3V0aWxzLmpzJztcclxuXHJcbmxldCBteUlkO1xyXG5cclxuZnVuY3Rpb24gZ2V0VXNlckluZm9SZXN1bHQodXNlckRhdGEpIHtcclxuICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XHJcbiAgcHJvZmlsZVByb2Zlc3Npb24udGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcclxuICBhdmF0YXJJbWFnZS5zcmMgPSB1c2VyRGF0YS5hdmF0YXI7XHJcbiAgbXlJZCA9IHVzZXJEYXRhLl9pZDtcclxufVxyXG5cclxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XHJcblxyXG5zZXRTdWJtaXRIYW5sZXJzKCk7XHJcblxyXG5zZXRQb3B1cENsb3NlRXZlbnRMaXN0ZW5lcnMoc2V0dGluZ3MpO1xyXG5cclxuUHJvbWlzZS5hbGwoW2dldFVzZXJJbmZvKCksIGdldENhcmRzKCldKVxyXG4gIC50aGVuKChbdXNlckRhdGEsIGNhcmRzXSkgPT4ge1xyXG4gICAgZ2V0VXNlckluZm9SZXN1bHQodXNlckRhdGEpO1xyXG4gICAgYWRkSW5pdGlhbENhcmRzKGNhcmRzKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjaGVja0Vycm9yKGVycik7XHJcbiAgfSk7XHJcblxyXG5leHBvcnQge1xyXG4gIG15SWRcclxufTsiXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImZpZWxkc2V0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJlcnJvckVsZW1lbnRTZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckVsZW1lbnRDbGFzcyIsImJ1dHRvbkNsb3NlQ2xhc3MiLCJwb3B1cENsYXNzIiwiZGlzYWJsZVNhdmVCdXR0b24iLCJwb3B1cCIsInNlbGVjdG9ycyIsImZvcm1FbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImJ1dHRvbkVsZW1lbnQiLCJjaGVja1ZhbGlkaXR5IiwiY2xhc3NMaXN0IiwiYWRkIiwiZGlzYWJsZWQiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsInNvbWUiLCJpbnB1dEVsZW1lbnQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwicmVtb3ZlIiwiY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJjaGVja0Vycm9yIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIndhaXRTYXZpbmciLCJldmVudCIsIml0ZW0iLCJzdWJtaXR0ZXIiLCJ0ZXh0Q29udGVudCIsInN0b3BTYXZpbmciLCJjb25maWciLCJiYXNlVXJsIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJwcm9maWxlUG9wdXAiLCJkb2N1bWVudCIsImNhcmRQb3B1cCIsImltYWdlUG9wdXAiLCJwcm9maWxlTmFtZSIsInByb2ZpbGVQcm9mZXNzaW9uIiwicHJvZmlsZUVkaXRCdXR0b24iLCJhZGRDYXJkQnV0dG9uIiwiaW5wdXRGdWxsTmFtZSIsImlucHV0UHJvZmVzc2lvbiIsImFkZEltYWdlTmFtZUlucHV0IiwiYWRkSW1hZ2VMaW5rSW5wdXQiLCJwcm9maWxlRWRpdEZvcm0iLCJhZGRJbWFnZUZvcm0iLCJ1cGRhdGVBdmF0YXJQb3B1cCIsImF2YXRhckltYWdlIiwiYXZhdGFyUHJvZmlsZVVwZGF0ZUNvbnRhaW5lciIsInVwZGF0ZUF2YXRhckZvcm0iLCJhdmF0YXJMaW5rSW5wdXQiLCJkZWxldGVDYXJkRm9ybSIsImRlbGV0ZUNhcmRQb3B1cCIsInBvcHVwcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvcGVuUG9wdXAiLCJhZGRFdmVudExpc3RlbmVyIiwiY2xvc2ViQnlFc2NhcGUiLCJjbG9zZVBvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImNvZGUiLCJkaXIiLCJ2YWx1ZSIsImNhcmRJZCIsInByZXZlbnREZWZhdWx0IiwiZWxlbUlkIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInRoZW4iLCJ0YXJnZXRFbGVtZW50IiwiY2F0Y2giLCJteUlkIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImNhcmRMaXN0IiwiY2FyZCIsImltYWdlUG9wdXBJbWFnZSIsImltYWdlUG9wdXBUaXRsZSIsImNyZWF0ZUNhcmQiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImltYWdlQ2FyZEVsZW1lbnQiLCJ0aXRsZUNhcmRFbGVtZW50IiwibGlrZUJ1dHRvbkNhcmRFbGVtZW50IiwiZGVsZXRlQnV0dG9uQ2FyZEVsZW1lbnQiLCJsaWtlQ291bnQiLCJvd25lciIsIl9pZCIsImxpa2VzIiwibGVuZ3RoIiwiaSIsImNvbnRhaW5zIiwiZGVsZXRlTGlrZSIsInJlc3VsdCIsInRhcmdldCIsImNsb3Nlc3QiLCJpZCIsInNyYyIsImFsdCIsImxpbmsiLCJuYW1lIiwiZm9yRWFjaCIsIkFycmF5IiwiZnJvbSIsImVycm9yRWxlbWVudCIsIm5leHRFbGVtZW50U2libGluZyIsImhpZGVJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNldEV2ZW50TGlzdGVuZXJzIiwiZnVsbG5hbWUiLCJwcm9mZXNzaW9uIiwiYWJvdXQiLCJmaW5hbGx5Iiwib2JqQ2FyZCIsInByZXBlbmQiLCJwcmVwZW5kTmV3Q2FyZCIsInJlc2V0IiwiaW5wdXQiLCJhdmF0YXIiLCJzZXRQb3B1cENsb3NlRXZlbnRMaXN0ZW5lcnMiLCJhbGwiLCJhcnIiLCJ1c2VyRGF0YSIsImNhcmRzIiwiZ2V0VXNlckluZm9SZXN1bHQiLCJrZXlzIiwiYXBwZW5kIl0sInNvdXJjZVJvb3QiOiIifQ==